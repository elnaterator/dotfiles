#!/bin/zsh

# =============================================================================
# ZSH Configuration
# =============================================================================

# Prevent double-loading in VSCode (shell integration causes re-source)
# if [[ -n "$_ZSHRC_LOADED" ]]; then
#   return
# fi
# export _ZSHRC_LOADED=1

# =============================================================================
# Human vs AI Agent Detection
# =============================================================================
# If it is an actual human using the terminal then load human settings
# Skip human settings if AI agent environment variables are detected
# Kiro terminals are detected by: TERM_PROGRAM=kiro AND Q_TERM_DISABLED=1
# VSCode GitHub Copilot terminals: TERM_PROGRAM=vscode AND VSCODE_PREVENT_SHELL_HISTORY=1
if [[ "$TERM_PROGRAM" == "kiro" && "$Q_TERM_DISABLED" == "1" ]] || \
   [[ "$TERM_PROGRAM" == "vscode" && "$VSCODE_PREVENT_SHELL_HISTORY" == "1" ]]; then
  # This is an AI agent terminal - skip human settings
  :
else
  # This appears to be a human terminal session
  [ -f ~/.dotfiles/shell/zshrc.human ] && source ~/.dotfiles/shell/zshrc.human
fi


# =============================================================================
# PATH Configuration
# =============================================================================
# Add dotfiles bin directory to PATH
export PATH="$HOME/.dotfiles/bin:$PATH"

# Standard paths
export PATH="$HOME/bin:$HOME/.local/bin:/usr/local/bin:$PATH"

# =============================================================================
# History Configuration
# =============================================================================
HISTFILE=~/.zsh_history
HISTSIZE=10000
SAVEHIST=10000
setopt APPEND_HISTORY           # Append to history file
setopt SHARE_HISTORY            # Share history between sessions
setopt HIST_IGNORE_DUPS         # Ignore duplicate commands
setopt HIST_IGNORE_SPACE        # Ignore commands starting with space
setopt HIST_REDUCE_BLANKS       # Remove unnecessary blanks

# =============================================================================
# Environment Variables
# =============================================================================
export EDITOR=vim
export VISUAL=vim

# Disable pager for AWS CLI by default (can be overridden in .zshrc.local)
export AWS_PAGER=""

# =============================================================================
# Mise (mise-en-place) - Development tool version manager
# =============================================================================
# Use shims instead of dynamic activate for compatibility with AI coding assistants
# This is more reliable for non-interactive shells like those used by Claude Code
if [ -d "$HOME/.local/share/mise/shims" ]; then
  export PATH="$HOME/.local/share/mise/shims:$PATH"
fi

# =============================================================================
# Load machine-specific configuration
# =============================================================================
# Create ~/.zshrc.local for machine-specific customizations
# (work-specific aliases, credentials, paths, etc.)
[ -f ~/.zshrc.local ] && source ~/.zshrc.local
